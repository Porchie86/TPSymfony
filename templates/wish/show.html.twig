{% extends 'base.html.twig' %}

{% block title %}Souhait - {{ wish.title }}{% endblock %}

{% block body %}
<div class="py-4">
    <h1 class="mb-3 text-gradient">{{ wish.title }}</h1>
    <p>{{ wish.description }}</p>
    <p><strong>Catégorie :</strong> {{ wish.category.name }}</p>
    <p><strong>Auteur :</strong> {{ wish.author }}</p>
    <hr>
    <h3>Commentaires</h3>
    {% if wish.comments|length == 0 %}
        <div class="alert alert-info">Aucun commentaire pour ce souhait.</div>
    {% else %}
        <ul class="list-group mb-3">
            {% for comment in wish.comments %}
                <li class="list-group-item">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <strong>{{ comment.author.pseudo }}</strong> le {{ comment.createdAt|date('d/m/Y H:i') }}<br>
                            {{ comment.content }}<br>
                            {% for i in 1..5 %}
                                {% if i <= comment.note %}
                                    &#9733;
                                {% else %}
                                    &#9734;
                                {% endif %}
                            {% endfor %}
                        </div>
                        <div>
                            {% if app.user and (comment.author == app.user or is_granted('ROLE_ADMIN')) %}
                                <a href="{{ path('app_comment_edit', {id: comment.id}) }}" class="btn btn-outline-secondary btn-sm">Modifier</a>
                                <form action="{{ path('app_comment_delete', {id: comment.id}) }}" method="post" style="display:inline;">
                                    <input type="hidden" name="_token" value="{{ csrf_token('delete_comment_' ~ comment.id) }}">
                                    <button type="submit" class="btn btn-outline-danger btn-sm">Supprimer</button>
                                </form>
                            {% endif %}
                        </div>
                    </div>
                </li>
            {% endfor %}
        </ul>
    {% endif %}
    {% if app.user and not isAuthor %}
        <h4>Ajouter un commentaire</h4>
        {% include 'comment/new.html.twig' with {form: commentForm, wish: wish} %}
    {% elseif app.user and isAuthor %}
        <div class="alert alert-warning">Vous ne pouvez pas commenter votre propre idée.</div>
    {% else %}
        <div class="alert alert-warning">Connectez-vous pour ajouter un commentaire.</div>
    {% endif %}
</div>
{% endblock %}
